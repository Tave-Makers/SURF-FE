set -eu
echo "ğŸ” ë¸Œëœì¹˜ ë„¤ì´ë° ê·œì¹™ ê²€ì‚¬ ì‹¤í–‰"

had_input=false
while read -r local_ref local_sha remote_ref remote_sha; do
  had_input=true
  case "$remote_ref" in
    refs/tags/*) continue ;; # íƒœê·¸ëŠ” ì œì™¸
  esac

  branch_name="${remote_ref#refs/heads/}"
  case "$branch_name" in
    main|develop) continue ;; # ë³´í˜¸ ë¸Œëœì¹˜ëŠ” í—ˆìš©
  esac

  if ! echo "$branch_name" | grep -Eq '^(feat|fix|hotfix|refactor|style|docs|chore|test|release)/[a-z0-9._-]+$'; then
    echo "âŒ ë¸Œëœì¹˜ ë„¤ì´ë° ê·œì¹™ ìœ„ë°˜"
    echo "ğŸ‘‰ ê·œì¹™ ì˜ˆì‹œ: feat/login-api, fix/navbar-bug-210"
    exit 1
  fi
done

# STDINì´ ë¹„ì–´ ìˆì„ ê²½ìš° ëŒ€ë¹„ (git push origin HEAD ë“±)
if [ "$had_input" = false ]; then
  branch_name="$(git rev-parse --abbrev-ref HEAD || echo '')"
  case "$branch_name" in
    ""|HEAD|main|develop) : ;; # í—ˆìš©
    *)
      if ! echo "$branch_name" | grep -Eq '^(feat|fix|hotfix|refactor|style|docs|chore|test|release)/[a-z0-9._-]+$'; then
        echo "âŒ ë¸Œëœì¹˜ ë„¤ì´ë° ê·œì¹™ ìœ„ë°˜"
        exit 1
      fi
      ;;
  esac
fi

echo "âœ… ë¸Œëœì¹˜ ë„¤ì´ë° ê·œì¹™ í†µê³¼"
